<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Class Monitor Voting</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="card shadow">
    <div class="card-body">
      <h3 class="text-center mb-3">Voting</h3>

      <h5 class="text-center text-primary">
        Total Votes: <span id="totalVotes">0</span>
      </h5>

      <div class="row mt-4">
        <div class="col-md-4">
          <input type="text" id="voterName" class="form-control" placeholder="Enter Voter Name">
        </div>

        <div class="col-md-4">
          <select id="candidate" class="form-select">
            <option value="">Select Candidate</option>
            <option>Leonardo</option>
            <option>Brad</option>
            <option>Jennifer</option>
            <option>Marshael</option>
            <option>Leo</option>
          </select>
        </div>

        <div class="col-md-4">
          <button class="btn btn-success w-100" onclick="addVote()">Vote</button>
        </div>
      </div>

      <hr>

      <h5>Candidate Votes</h5>
      <ul id="voteCount" class="list-group mb-4"></ul>

      <h5>Voters List</h5>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Voter Name</th>
            <th>Voted For</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="votersTable"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  const API_URL = "https://crudcrud.com/api/a583d47882aa401da51469a544f8a024/votes";

  const candidates = ["Leonardo", "Brad", "Jennifer", "Marshael", "Leo"];

  document.addEventListener("DOMContentLoaded", fetchVotes);

  async function fetchVotes() {
    const res = await fetch(API_URL);
    const votes = await res.json();
    renderVotes(votes);
  }

  async function addVote() {
    const voterName = document.getElementById("voterName").value.trim();
    const candidate = document.getElementById("candidate").value;

    if (!voterName || !candidate) {
      alert("Please enter voter name and select candidate");
      return;
    }

    const res = await fetch(API_URL);
    const votes = await res.json();

    const alreadyVoted = votes.find(
      v => v.voterName.toLowerCase() === voterName.toLowerCase()
    );

    if (alreadyVoted) {
      alert("This voter has already voted!");
      return;
    }

    await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ voterName, candidate })
    });

    document.getElementById("voterName").value = "";
    document.getElementById("candidate").value = "";

    fetchVotes();
  }

  function renderVotes(votes) {
    const voteCount = {};
    candidates.forEach(c => voteCount[c] = 0);

    votes.forEach(v => {
      if (voteCount[v.candidate] !== undefined) {
        voteCount[v.candidate]++;
      }
    });

    document.getElementById("totalVotes").innerText = votes.length;

    const voteCountList = document.getElementById("voteCount");
    voteCountList.innerHTML = "";
    candidates.forEach(c => {
      voteCountList.innerHTML += `
        <li class="list-group-item d-flex justify-content-between">
          ${c}
          <span class="badge bg-primary">${voteCount[c]}</span>
        </li>`;
    });

    const table = document.getElementById("votersTable");
    table.innerHTML = "";
    votes.forEach(v => {
      table.innerHTML += `
        <tr>
          <td>${v.voterName}</td>
          <td>${v.candidate}</td>
          <td>
            <button class="btn btn-danger btn-sm"
              onclick="deleteVote('${v._id}')">
              Delete
            </button>
          </td>
        </tr>`;
    });
  }

  async function deleteVote(id) {
    await fetch(`${API_URL}/${id}`, { method: "DELETE" });
    fetchVotes();
  }
</script>

</body>
</html>
